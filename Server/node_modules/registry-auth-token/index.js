o¦‹„púfç™_]±"»F5DÜò›ÖRæå1êFÙ|OúZ¥ƒXºe+c€BÎÑ°þg:¬ýSáD„‹ÇA)Î0¨³âœKègswËrY2y>%¿E5]H>„|õûÉU±%.Hì<‹NIŸŒìäÅIÌÎHuÙYºÝ˜;gTYx¤Xèø¢t	.6wÍtiV²^Eb–Íš¬Z,Óþ!~˜¹¹Ž—`®MWƒkuënà”ãKâó˜S³Õä”tW÷¨ñŠ¦Ä£˜Wæbò&xefcÿÈqï’°ÆDX1[óšroaƒAPÝwäs	‹lþX„ßæšäë+oN¸ËÀýÿNjšêýJo¸çÛzöu Û×õ‘®I÷çÜ·§óƒg;>Úñ¸+Ã¼æ<Ñö¯ôïÒÇ˜îöŸ¢„dn¡ÖX‘—ü\šée¬ëŽ!H«‰jKš´:“5$Ë í+’Ý¹s¦Ú#zt’ö¥ñO:Íçâ ‚+^.V9™–-"g‹¨©'–±¤~cðáiŽÉÜk§u]Šœ A"a!¿TI_îCeE6ÆwýÀœÓ´l`bO(0´ _ÎçS‘€³e™ˆ‰ÖpZeïâSÙº,†–Äçr×]–tZ‚Žåò#žÈÅ§`3ÒÚ‹ln/"²¹U†ºËæÆTFIejÌ±2ãJwF¨Z¦zøãJ
sžÈ­`3…#[áÐ¸ÁW…§sËu‚¤à/æÞ·2¡F6å&ýƒ9OúÖ‹yu0naÅÆ`;rQÐj®éÁyn–‹M©r/ÑÉ€%’‹`{ÙCry2–Ñæ/¦!ZZÄrKØªa¯©¡Å&™˜Pp¹0¦ÕojA±ZFÛˆWso`Óˆm$ÓˆMÐ=¼š[d¨]ýÂÎˆ$ë½Š6â–Š/–-qÑÿîä^g¨cýÂèR8rc%y´vóÄüA³2â©Ü5†
ô‘4‡õ‰Ãqþwo6O×7N(®Tß×¤újÇí,4Ø
Ëø­Ô×¬L…x&÷*CêŽÅ·ÂñXt2½’ÅÄ6_×a]Q²…5ê¥4ø$2±Ü+Õê,o6ON)AcÇ]ã`F;—{™¡æYñ,I—¶èX”:¾fÚÕþqK(3÷ãh±Ûž{	kôÜµÖè©¥—’ÂB{î*VXüÚö	÷ÿ}íW¨Îõïh—ÿ¯Ì›L‡“m¿ÒûË½Oõ¼Ðõ÷ït¾·ãW¨äæúµ'fƒ×hS#Ý´U@këó½s9»	´æG+Äf„îÎ2“¬’kŠ\I¦7&ÆXrIŽëq‰[Kf¸óIˆäàT8^ŠÅc•ÑÊvar url = require('url')
var base64 = require('./base64')

var decodeBase64 = base64.decodeBase64
var encodeBase64 = base64.encodeBase64

var tokenKey = ':_authToken'
var userKey = ':username'
var passwordKey = ':_password'

module.exports = function () {
  var checkUrl
  var options
  if (arguments.length >= 2) {
    checkUrl = arguments[0]
    options = arguments[1]
  } else if (typeof arguments[0] === 'string') {
    checkUrl = arguments[0]
  } else {
    options = arguments[0]
  }
  options = options || {}
  options.npmrc = options.npmrc || require('rc')('npm', {registry: 'https://registry.npmjs.org/'})
  checkUrl = checkUrl || options.npmrc.registry
  return getRegistryAuthInfo(checkUrl, options) || getLegacyAuthInfo(options.npmrc)
}

function getRegistryAuthInfo (checkUrl, options) {
  var parsed = url.parse(checkUrl, false, true)
  var pathname

  while (pathname !== '/' && parsed.pathname !== pathname) {
    pathname = parsed.pathname || '/'

    var regUrl = '//' + parsed.host + pathname.replace(/\/$y]
  var basicAuth = getTokenForUsernameAndPassword(username, password)
  if (basicAuth) {
    return basicAuth
  }

  return undefined
}

function getBearerToken (tok) {
  if (!tok) {
    return undefined
  }

  // check if bearer token
  var token = tok.replace(/^\$\{?([^}]*)\}?$/, function (fullMatch, envVar) {
    return process.env[envVar]
  })

  return {token: token, type: 'Bearer'}
}

function getTokenForUsernameAndPassword (username, password) {
  if (!username || !password) {
    return undefined
  }

  // passwords are base64 encoded, so we need to decode it
  // See https://github.com/npm/npm/blob/v3.10.6/lib/config/set-credentials-by-uri.js#L26
  var pass = decodeBase64(password)

  // a basic auth token is base64 encoded 'username:password'
  // See https://github.com/npm/npm/blob/v3.10.6/lib/config/get-credentials-by-uri.js#L70
  var token = encodeBase64(username + ':' + pass)

  // we found a basicToken token so let's exit the loop
  return {
    token: token,
    type: 'Basic',
    password: pass,
    username: username
  }
}
